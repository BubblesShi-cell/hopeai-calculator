<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Hopeai | æ——èˆ°çº§ä¸´åºŠæ ·æœ¬é‡è®¡ç®—å¹³å° v6.1</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --hopeai-purple: #6f42c1; --hopeai-gradient: linear-gradient(135deg, #6f42c1 0%, #4e73df 100%); }
        body { background-color: #f0f2f5; font-family: 'PingFang SC', system-ui, sans-serif; padding-bottom: 50px; }
        
        /* é¡µçœ‰ */
        .navbar-hopeai { background: #fff; border-bottom: 1px solid #e2e8f0; padding: 10px 30px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .brand-logo { font-size: 22px; font-weight: 800; color: var(--hopeai-purple); }
        .brand-logo span { color: #64748b; font-weight: 400; font-size: 14px; margin-left: 10px; border-left: 1px solid #ddd; padding-left: 10px; }

        .main-container { max-width: 1000px; margin: auto; }
        .calculator-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }

        /* å¤šè¡Œé€‰é¡¹å¡ç¾åŒ– */
        .nav-pills { background: #f8fafc; padding: 5px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #edf2f7; gap: 5px; }
        .nav-pills .nav-item { flex: 1 1 23%; } 
        .nav-pills .nav-link { color: #64748b; font-weight: 600; font-size: 13px; border-radius: 8px; padding: 10px; width: 100%; text-align: center; border: 1px solid transparent; }
        .nav-pills .nav-link.active { background: var(--hopeai-gradient); color: white; }

        .section-box { border: 1px solid #f1f5f9; border-radius: 12px; padding: 18px; margin-bottom: 18px; background: #fff; }
        .section-title { font-size: 15px; font-weight: 700; color: #1e293b; margin-bottom: 15px; display: flex; align-items: center; }
        .section-title::before { content: ""; width: 4px; height: 16px; background: var(--hopeai-purple); margin-right: 10px; border-radius: 2px; }

        /* å…¬å¼å±•ç¤ºåŒº */
        .formula-card { background: #fdfbff; border: 1px dashed #d1c4e9; border-radius: 10px; padding: 15px; margin-top: 10px; font-family: "Cambria", serif; color: #4527a0; text-align: center; min-height: 80px; display: flex; flex-direction: column; justify-content: center; }
        .formula-title { font-size: 11px; color: #9575cd; text-transform: uppercase; margin-bottom: 8px; font-weight: bold; }

        .result-panel { background: var(--hopeai-gradient); border-radius: 16px; color: white; padding: 30px; text-align: center; margin-top: 20px; box-shadow: 0 10px 20px rgba(111, 66, 193, 0.2); }
        .result-number { font-size: 4rem; font-weight: 900; line-height: 1; margin: 10px 0; }
        
        .btn-run { background: #1e293b; color: white; border: none; padding: 16px; border-radius: 12px; width: 100%; font-weight: 700; font-size: 1.1rem; transition: 0.3s; }
        .btn-run:hover { background: #000; transform: translateY(-2px); }
        
        .footer-text { text-align: center; margin-top: 30px; color: #94a3b8; font-size: 12px; line-height: 1.6; }
    </style>
</head>
<body>

<nav class="navbar-hopeai">
    <div class="brand-logo">Hopeai <span>æ——èˆ°çº§ä¸´åºŠå†³ç­–æ”¯æŒç³»ç»Ÿ</span></div>
    <div class="badge bg-light text-dark border">v6.1 Ultimate</div>
</nav>

<div class="main-container">
    <div class="calculator-card">
        
        <!-- ç¬¬ä¸€å±‚ï¼šå›ºå®šå‚æ•° -->
        <div class="section-box">
            <div class="section-title">æ ¸å¿ƒç»Ÿè®¡æ•ˆèƒ½è®¾ç½®</div>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label small fw-bold">æ˜¾è‘—æ€§æ°´å¹³ (Alpha)</label>
                    <select id="alpha" class="form-select" onchange="updateFormula()">
                        <option value="0.05" selected>0.05 (å¸¸ç”¨åŒä¾§)</option>
                        <option value="0.025">0.025 (ä¸¥è°¨å•ä¾§)</option>
                        <option value="0.01">0.01</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold">æ£€éªŒæ•ˆèƒ½ (Power, 1-Beta)</label>
                    <select id="power" class="form-select" onchange="updateFormula()">
                        <option value="0.8" selected>0.80 (80%)</option>
                        <option value="0.9">0.90 (90%)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒå±‚ï¼šç ”ç©¶è®¾è®¡åˆ‡æ¢ -->
        <ul class="nav nav-pills" id="methodTab">
            <li class="nav-item"><button class="nav-link active" id="mean-tab" data-bs-toggle="pill" data-bs-target="#pane-mean" onclick="updateFormula()">å‡å€¼æ¯”è¾ƒ</button></li>
            <li class="nav-item"><button class="nav-link" id="prop-tab" data-bs-toggle="pill" data-bs-target="#pane-prop" onclick="updateFormula()">ç‡çš„æ¯”è¾ƒ</button></li>
            <li class="nav-item"><button class="nav-link" id="survival-tab" data-bs-toggle="pill" data-bs-target="#pane-survival" onclick="updateFormula()">ç”Ÿå­˜åˆ†æ</button></li>
            <li class="nav-item"><button class="nav-link" id="sup-tab" data-bs-toggle="pill" data-bs-target="#pane-sup" onclick="updateFormula()">ä¼˜æ•ˆæ€§ç ”ç©¶</button></li>
            <li class="nav-item"><button class="nav-link" id="ni-tab" data-bs-toggle="pill" data-bs-target="#pane-ni" onclick="updateFormula()">éåŠ£æ•ˆç ”ç©¶</button></li>
            <li class="nav-item"><button class="nav-link" id="eq-tab" data-bs-toggle="pill" data-bs-target="#pane-eq" onclick="updateFormula()">ç­‰æ•ˆæ€§ç ”ç©¶</button></li>
            <li class="nav-item"><button class="nav-link" id="diag-tab" data-bs-toggle="pill" data-bs-target="#pane-diag" onclick="updateFormula()">è¯Šæ–­è¯•éªŒ</button></li>
            <li class="nav-item"><button class="nav-link" id="case-tab" data-bs-toggle="pill" data-bs-target="#pane-case" onclick="updateFormula()">ç—…ä¾‹å¯¹ç…§ç ”ç©¶</button></li>
        </ul>

        <!-- ç¬¬ä¸‰å±‚ï¼šåŠ¨æ€å˜é‡è¾“å…¥ -->
        <div class="section-box">
            <div class="section-title">ç ”ç©¶å‚æ•°è¾“å…¥</div>
            <div class="tab-content" id="tabContent">
                <!-- å‡å€¼æ¯”è¾ƒ -->
                <div class="tab-pane fade show active" id="pane-mean">
                    <div class="row g-3">
                        <div class="col-md-6"><label class="form-label small fw-bold">é¢„æœŸå·®å€¼ (Î´)</label><input type="number" id="mean_delta" class="form-control" placeholder="å¦‚: 5"></div>
                        <div class="col-md-6"><label class="form-label small fw-bold">æ ‡å‡†å·® (Ïƒ)</label><input type="number" id="mean_sd" class="form-control" placeholder="å¦‚: 10"></div>
                    </div>
                </div>
                <!-- ç‡çš„æ¯”è¾ƒ -->
                <div class="tab-pane fade" id="pane-prop">
                    <div class="row g-3">
                        <div class="col-md-6"><label class="form-label small fw-bold">å¯¹ç…§ç»„ç‡ (P1)</label><input type="number" id="prop_p1" class="form-control" placeholder="0.3"></div>
                        <div class="col-md-6"><label class="form-label small fw-bold">è¯•éªŒç»„ç‡ (P2)</label><input type="number" id="prop_p2" class="form-control" placeholder="0.5"></div>
                    </div>
                </div>
                <!-- ç”Ÿå­˜åˆ†æ -->
                <div class="tab-pane fade" id="pane-survival">
                    <div class="row g-3">
                        <div class="col-md-4"><label class="form-label small fw-bold">é£é™©æ¯” (HR)</label><input type="number" id="surv_hr" class="form-control" placeholder="å¦‚: 0.7"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">é¢„æœŸäº‹ä»¶ç‡ (ER)</label><input type="number" id="surv_er" class="form-control" placeholder="å¦‚: 0.5"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">åˆ†é…æ¯”ä¾‹ (k)</label><input type="number" id="surv_k" class="form-control" value="1"></div>
                    </div>
                </div>
                <!-- ä¼˜æ•ˆ/éåŠ£æ•ˆ -->
                <div class="tab-pane fade" id="pane-sup">
                    <div class="row g-3">
                        <div class="col-md-4"><label class="form-label small fw-bold">é¢„æœŸå·®å€¼ (Trial-Ref)</label><input type="number" id="sup_delta" class="form-control" placeholder="é¢„æœŸçœŸå®å·®å€¼"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">æ ‡å‡†å·® (Ïƒ)</label><input type="number" id="sup_sd" class="form-control"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">ä¼˜æ•ˆç•Œå€¼ (Î´â‚€)</label><input type="number" id="sup_margin" class="form-control" value="0"></div>
                    </div>
                </div>
                <div class="tab-pane fade" id="pane-ni">
                    <div class="row g-3">
                        <div class="col-md-4"><label class="form-label small fw-bold">é¢„æœŸå·®å€¼ (Î´)</label><input type="number" id="ni_delta" class="form-control" value="0"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">æ ‡å‡†å·® (Ïƒ)</label><input type="number" id="ni_sd" class="form-control"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">éåŠ£æ•ˆç•Œå€¼ (M)</label><input type="number" id="ni_margin" class="form-control" placeholder="æ­£å€¼"></div>
                    </div>
                </div>
                <!-- ç­‰æ•ˆæ€§ç ”ç©¶ -->
                <div class="tab-pane fade" id="pane-eq">
                    <div class="row g-3">
                        <div class="col-md-4"><label class="form-label small fw-bold">é¢„æœŸå·®å€¼ (Î´)</label><input type="number" id="eq_delta" class="form-control" value="0"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">æ ‡å‡†å·® (Ïƒ)</label><input type="number" id="eq_sd" class="form-control"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold">ç­‰æ•ˆåŒºé—´ (Î”)</label><input type="number" id="eq_margin" class="form-control" placeholder="åŒå‘ç•Œå€¼"></div>
                    </div>
                </div>
                <!-- è¯Šæ–­è¯•éªŒ -->
                <div class="tab-pane fade" id="pane-diag">
                    <div class="row g-3">
                        <div class="col-md-6"><label class="form-label small fw-bold">é¢„æœŸçµæ•åº¦/ç‰¹å¼‚åº¦ (P)</label><input type="number" id="diag_p" class="form-control" placeholder="0.8-0.95"></div>
                        <div class="col-md-6"><label class="form-label small fw-bold">å…è®¸è¯¯å·® (L)</label><input type="number" id="diag_l" class="form-control" placeholder="é€šå¸¸0.05-0.1"></div>
                    </div>
                </div>
                <!-- ç—…ä¾‹å¯¹ç…§ç ”ç©¶ (Case-Control) -->
                <div class="tab-pane fade" id="pane-case">
                    <div class="row g-3">
                        <div class="col-md-6"><label class="form-label small fw-bold">å¯¹ç…§ç»„æš´éœ²ç‡ (Pâ‚€)</label><input type="number" id="case_p0" class="form-control" placeholder="å¦‚ 0.2"></div>
                        <div class="col-md-6"><label class="form-label small fw-bold">é¢„æœŸä¼˜åŠ¿æ¯” (OR)</label><input type="number" id="case_or" class="form-control" placeholder="å¦‚ 2.5"></div>
                    </div>
                </div>
            </div>

            <!-- å…¬å¼å®æ—¶æ˜¾ç¤º -->
            <div class="formula-card">
                <div class="formula-title">å½“å‰è®¡ç®—æ¨¡å‹ç®—æ³•å…¬å¼ (Statistical Formula Reference)</div>
                <div id="formula-latex">n = 2 * (Z<sub>1-Î±/2</sub> + Z<sub>1-Î²</sub>)<sup>2</sup> * Ïƒ<sup>2</sup> / Î´<sup>2</sup></div>
            </div>
        </div>

        <button onclick="mainCalculate()" class="btn btn-run">ğŸš€ æ‰§è¡Œ Hopeai AI æ ¸å¿ƒè®¡ç®—</button>

        <div class="result-panel">
            <div style="font-size: 14px; opacity: 0.85;" id="result-label">å»ºè®®æ ·æœ¬é‡ä¼°ç®—ç»“æœ (N)</div>
            <div class="result-number" id="result">--</div>
            <div id="event-info" style="font-weight: 600; font-size: 14px; margin-top: 5px;"></div>
        </div>

        <div class="footer-text">
            Â© 2024 Hopeai Digital Health Group. <br>
            ä¿®æ­£è¯´æ˜ï¼šç—…ä¾‹å¯¹ç…§ç ”ç©¶åŸºäºä¼˜åŠ¿æ¯”(OR)è®¡ç®— $P_1 = (OR \cdot P_0) / (1 + P_0(OR-1))$ï¼Œç»§è€Œä¼°ç®—æ ·æœ¬é‡ã€‚
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
    const formulaMap = {
        'mean-tab': 'n = 2 * (Z<sub>1-Î±/2</sub> + Z<sub>1-Î²</sub>)<sup>2</sup> * Ïƒ<sup>2</sup> / Î´<sup>2</sup>',
        'prop-tab': 'n = (Z<sub>1-Î±/2</sub>âˆš[2P(1-P)] + Z<sub>1-Î²</sub>âˆš[P1(1-P1)+P2(1-P2)])<sup>2</sup> / (P1-P2)<sup>2</sup>',
        'survival-tab': 'E = 4 * (Z<sub>1-Î±/2</sub> + Z<sub>1-Î²</sub>)<sup>2</sup> / (ln HR)<sup>2</sup>  ;  N = E / ER',
        'sup-tab': 'n = 2 * (Z<sub>1-Î±</sub> + Z<sub>1-Î²</sub>)<sup>2</sup> * Ïƒ<sup>2</sup> / (Î´ - Î´â‚€)<sup>2</sup>',
        'ni-tab': 'n = 2 * (Z<sub>1-Î±</sub> + Z<sub>1-Î²</sub>)<sup>2</sup> * Ïƒ<sup>2</sup> / (Î´ - M)<sup>2</sup>',
        'eq-tab': 'n = 2 * (Z<sub>1-Î±</sub> + Z<sub>1-Î²</sub>)<sup>2</sup> * Ïƒ<sup>2</sup> / Î”<sup>2</sup>',
        'diag-tab': 'n = Z<sub>1-Î±/2</sub><sup>2</sup> * P(1-P) / L<sup>2</sup>',
        'case-tab': 'P<sub>1</sub> = (ORÂ·Pâ‚€)/(1+Pâ‚€(OR-1)) ; n = (Z<sub>1-Î±/2</sub>âˆš[2P(1-P)] + Z<sub>1-Î²</sub>âˆš[P1(1-P1)+P0(1-P0)])<sup>2</sup> / (P1-P0)<sup>2</sup>'
    };

    function updateFormula() {
        const activeTab = document.querySelector('.nav-link.active').id;
        document.getElementById('formula-latex').innerHTML = formulaMap[activeTab] || '--';
    }

    function mainCalculate() {
        const alpha = parseFloat(document.getElementById('alpha').value);
        const power = parseFloat(document.getElementById('power').value);
        const activeTab = document.querySelector('.nav-link.active').id;
        
        const zDouble = { "0.05": 1.96, "0.01": 2.576, "0.025": 2.24 };
        const zSingle = { "0.05": 1.645, "0.025": 1.96, "0.01": 2.326 };
        const zPower = { "0.8": 0.842, "0.9": 1.282 };

        let za = zDouble[alpha] || 1.96;
        let zb = zPower[power];
        let n = 0, event_text = "";

        try {
            if (activeTab === 'mean-tab') {
                const delta = parseFloat(document.getElementById('mean_delta').value);
                const sd = parseFloat(document.getElementById('mean_sd').value);
                n = (2 * Math.pow((za + zb), 2) * Math.pow(sd, 2)) / Math.pow(delta, 2);
            } 
            else if (activeTab === 'prop-tab') {
                const p1 = parseFloat(document.getElementById('prop_p1').value);
                const p2 = parseFloat(document.getElementById('prop_p2').value);
                const p_avg = (p1 + p2) / 2;
                n = Math.pow((za * Math.sqrt(2 * p_avg * (1 - p_avg)) + zb * Math.sqrt(p1*(1-p1) + p2*(1-p2))), 2) / Math.pow((p1 - p2), 2);
            }
            else if (activeTab === 'survival-tab') {
                const hr = parseFloat(document.getElementById('surv_hr').value);
                const er = parseFloat(document.getElementById('surv_er').value);
                const k = parseFloat(document.getElementById('surv_k').value);
                const E = Math.pow((k + 1), 2) / k * Math.pow((za + zb), 2) / Math.pow(Math.log(hr), 2);
                n = (E / er) / (k + 1);
                event_text = `é¢„è®¡äº‹ä»¶æ•° (Events): ${Math.ceil(E)}`;
            }
            else if (activeTab === 'sup-tab' || activeTab === 'ni-tab') {
                const s_za = zSingle[alpha] || 1.645;
                const delta = parseFloat(document.getElementById(activeTab === 'sup-tab' ? 'sup_delta' : 'ni_delta').value);
                const sd = parseFloat(document.getElementById(activeTab === 'sup-tab' ? 'sup_sd' : 'ni_sd').value);
                const margin = parseFloat(document.getElementById(activeTab === 'sup-tab' ? 'sup_margin' : 'ni_margin').value);
                n = (2 * Math.pow((s_za + zb), 2) * Math.pow(sd, 2)) / Math.pow((delta - margin), 2);
            }
            else if (activeTab === 'eq-tab') {
                const s_za = zSingle[alpha] || 1.645;
                const sd = parseFloat(document.getElementById('eq_sd').value);
                const margin = parseFloat(document.getElementById('eq_margin').value);
                n = (2 * Math.pow((s_za + zb), 2) * Math.pow(sd, 2)) / Math.pow(margin, 2);
            }
            else if (activeTab === 'diag-tab') {
                const p = parseFloat(document.getElementById('diag_p').value);
                const l = parseFloat(document.getElementById('diag_l').value);
                n = (Math.pow(za, 2) * p * (1 - p)) / Math.pow(l, 2);
            }
            else if (activeTab === 'case-tab') {
                const p0 = parseFloat(document.getElementById('case_p0').value);
                const or = parseFloat(document.getElementById('case_or').value);
                // è®¡ç®—ç—…ä¾‹ç»„æš´éœ²ç‡ P1
                const p1 = (or * p0) / (1 + p0 * (or - 1));
                const p_avg = (p1 + p0) / 2;
                n = Math.pow((za * Math.sqrt(2 * p_avg * (1 - p_avg)) + zb * Math.sqrt(p1 * (1 - p1) + p0 * (1 - p0))), 2) / Math.pow((p1 - p0), 2);
            }

            const finalN = Math.ceil(n);
            document.getElementById('result').innerText = (isNaN(finalN) || !isFinite(finalN)) ? "--" : finalN;
            document.getElementById('event-info').innerText = event_text;
        } catch (e) { alert("è¾“å…¥å‚æ•°æœ‰è¯¯"); }
    }
    window.onload = updateFormula;
</script>
</body>
</html>